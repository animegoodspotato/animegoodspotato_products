<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å°åº—</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #fdfaf5; margin: 0; padding: 20px; color: #444; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { text-align: center; color: #6a8caf; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08); display: flex; flex-direction: column; }
        .img-box { width: 100%; height: 160px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        .info { padding: 12px; text-align: center; }
        .name { font-weight: bold; font-size: 14px; margin-bottom: 5px; height: 40px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.4; }
        .price { color: #e67e22; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

<div class="container">
    <h1>âœ¨ æ­¡è¿å…‰è‡¨ âœ¨</h1>
    <div id="loading" style="text-align:center; padding:50px; color:#999;">ğŸšš è²¨å“é‹é€ä¸­...</div>
    <div id="shop-content" class="grid"></div>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzv6LyBK2hRBmz4H6t0qk3FLX946QxhILyL1Ni6DQM1b9_9OhZjBHP2_1U_dJMaRkv5/exec';
    const APP_ID = 'e90e882a-4485-4935-9597-5416ab5b3230';
    const TABLE_NAME = 'Google Sheets ç¯„ä¾‹èˆ‡å»ºè­°';

    function getImgUrl(cellData) {
        if (!cellData) return 'https://via.placeholder.com/160?text=No+Image';
        var str = cellData.toString();

        // âœ‚ï¸ è‡ªå‹•åˆ‡å‰²ï¼šå¦‚æœæœ‰é€—è™Ÿ (å¤šå¼µç›¸)ï¼Œåªå–ç¬¬ä¸€å¼µ
        if (str.indexOf(',') > -1) {
            str = str.split(',')[0].trim();
        }

        // â˜ï¸ è™•ç† Google Drive
        if (str.indexOf('drive.google.com') > -1) {
            var fileId = "";
            try {
                if (str.indexOf('id=') > -1) {
                    fileId = str.split('id=')[1].split('&')[0];
                } else if (str.indexOf('/d/') > -1) {
                    fileId = str.split('/d/')[1].split('/')[0];
                }
                // ä½¿ç”¨ thumbnail ç›´é€£ï¼Œæœ€ç©©å®š
                return 'https://drive.google.com/thumbnail?id=' + fileId + '&sz=w600';
            } catch(e) { return str; }
        }

        // ğŸ“± è™•ç† AppSheet
        return 'https://www.appsheet.com/template/gettablefileurl?appName=' + APP_ID + '&tableName=' + encodeURIComponent(TABLE_NAME) + '&fileName=' + encodeURIComponent(str);
    }

    async function loadShop() {
        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            document.getElementById('loading').style.display = 'none';
            var content = document.getElementById('shop-content');

            data.forEach(function(item) {
                var finalUrl = getImgUrl(item['ç›¸ç‰‡ 1']);
                var card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = 
                    '<div class="img-box">' +
                        '<img src="' + finalUrl + '" onerror="this.src=\'https://via.placeholder.com/160?text=åœ–ç‰‡è¼‰å…¥ä¸­\';">' +
                    '</div>' +
                    '<div class="info">' +
                        '<div class="name">' + (item['è²¨å“åç¨±'] || 'æœªå‘½å') + '</div>' +
                        '<div class="price">MOP ' + (item['åƒ¹éŒ¢ (MOP)'] || '0') + '</div>' +
                    '</div>';
                content.appendChild(card);
            });
        } catch (e) {
            document.getElementById('loading').innerText = 'è¼‰å…¥å¤±æ•—ï¼Œè«‹åˆ·æ–°é é¢ã€‚';
        }
    }
    loadShop();
</script>
</body>
</html>
