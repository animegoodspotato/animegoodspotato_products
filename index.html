<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å°åº—æ«¥çª—</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #fdfaf5; margin: 0; padding: 20px; color: #444; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08); display: flex; flex-direction: column; }
        /* åœ–ç‰‡ä½åŠ å€‹ç°è‰²åº•è‰²åŒ Loading æ–‡å­— */
        .img-box { width: 100%; height: 160px; background: #eeeeee; display: flex; align-items: center; justify-content: center; overflow: hidden; color: #999; font-size: 12px; }
        img { width: 100%; height: 100%; object-fit: cover; }
        .info { padding: 12px; text-align: center; }
        .name { font-weight: bold; font-size: 14px; margin-bottom: 5px; height: 40px; overflow: hidden; line-height: 1.4; }
        .price { color: #e67e22; font-weight: bold; }
    </style>
</head>
<body>

<h1 style="text-align:center; color:#6a8caf;">âœ¨ æ­¡è¿å…‰è‡¨ âœ¨</h1>
<div id="loading" style="text-align:center; padding:50px;">ğŸ” è²¨å“åŠªåŠ›ä¸Šæ¶ä¸­...</div>
<div id="shop-content" class="grid"></div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzv6LyBK2hRBmz4H6t0qk3FLX946QxhILyL1Ni6DQM1b9_9OhZjBHP2_1U_dJMaRkv5/exec';
    
    // å…§å»ºä¸€å¼µ SVG åœ–ç‰‡ï¼Œå””ä½¿å†é€£å» placeholder ç¶²ç«™ï¼Œè§£æ±º ERR_NAME_NOT_RESOLVED
    const LOADING_SVG = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjE2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZWVlZWVlIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZpbGw9IiM5OTkiIGZvbnQtc2l6ZT0iMTIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRpPS"';

    function getImgUrl(cellData) {
        if (!cellData) return '';
        let str = cellData.toString();

        // âœ‚ï¸ å…ˆè§£æ±ºã€Œå…©å¼µç›¸ã€å˜…å•é¡Œï¼šç”¨é€—è™Ÿã€åˆ†è™Ÿæˆ–è€…ç©ºæ ¼åˆ‡é–‹ï¼Œåªæ”ç¬¬ä¸€èˆŠå˜¢
        let firstPart = str.split(/[,;\s]+/)[0].trim();

        // â˜ï¸ è™•ç† Google Drive é€£çµï¼Œæå– ID
        let fileId = "";
        if (firstPart.includes('id=')) {
            fileId = firstPart.split('id=')[1].split('&')[0];
        } else if (firstPart.includes('/d/')) {
            fileId = firstPart.split('/d/')[1].split('/')[0];
        }

        if (fileId) {
            // ä½¿ç”¨ç›®å‰ GitHub Pages æœ€ç©©å®šå˜… HTTPS ç¸®åœ–æ ¼å¼
            return 'https://drive.google.com/thumbnail?id=' + fileId + '&sz=w800';
        }
        
        // å¦‚æœä¿‚æ™®é€šæª”æ¡ˆå (AppSheet å½±å˜…ç›¸)
        const APP_ID = 'e90e882a-4485-4935-9597-5416ab5b3230';
        const TABLE_NAME = 'Google Sheets ç¯„ä¾‹èˆ‡å»ºè­°';
        return 'https://www.appsheet.com/template/gettablefileurl?appName=' + APP_ID + '&tableName=' + encodeURIComponent(TABLE_NAME) + '&fileName=' + encodeURIComponent(firstPart);
    }

    fetch(API_URL)
    .then(r => r.json())
    .then(data => {
        document.getElementById('loading').style.display = 'none';
        const content = document.getElementById('shop-content');
        data.forEach(item => {
            const imgUrl = getImgUrl(item['ç›¸ç‰‡ 1']);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="img-box">
                    <img src="${imgUrl}" loading="lazy" onerror="this.parentElement.innerHTML='ç„¡åœ–ç‰‡';">
                </div>
                <div class="info">
                    <div class="name">${item['è²¨å“åç¨±'] || 'æœªå‘½å'}</div>
                    <div class="price">MOP ${item['åƒ¹éŒ¢ (MOP)'] || '0'}</div>
                </div>
            `;
            content.appendChild(card);
        });
    })
    .catch(err => {
        document.getElementById('loading').innerText = 'è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²çµ¡é€£ç·šã€‚';
    });
</script>
</body>
</html>
